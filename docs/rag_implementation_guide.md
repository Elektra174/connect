# üß† –ì–ò–î –ü–û –°–û–ó–î–ê–ù–ò–Æ –í–ï–ö–¢–û–†–ù–û–ì–û –ú–û–ó–ì–ê CONNECTUM (RAG)

## –í–í–ï–î–ï–ù–ò–ï

–ß—Ç–æ–±—ã –ò–ò ¬´—á–∏—Ç–∞–ª¬ª –±–∞–∑—É –∏–∑ 300+ –º–æ–¥—É–ª–µ–π –Ω–∞ –ª–µ—Ç—É, –Ω–∞–º –Ω—É–∂–Ω–æ –ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å —Ç–µ–∫—Å—Ç –≤ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –≤–µ–∫—Ç–æ—Ä—ã (embeddings) –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏—Ö –≤ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö Supabase. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–∏—Å—Ç–µ–º–µ –Ω–µ –ø—Ä–æ—Å—Ç–æ –∏—Å–∫–∞—Ç—å —Å–ª–æ–≤–∞, –∞ –ø–æ–Ω–∏–º–∞—Ç—å —Å–º—ã—Å–ª –∑–∞–ø—Ä–æ—Å–∞ –ø—Å–∏—Ö–æ–ª–æ–≥–∞.

## üí∞ –≠–ö–û–ù–û–ú–ò–ö–ê: –ü–û–ß–ï–ú–£ –≠–¢–û –ë–ï–°–ü–õ–ê–¢–ù–û?

**Supabase (Free Tier):** –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç 500 –ú–ë —Ö—Ä–∞–Ω–∏–ª–∏—â–∞. –ë–∞–∑–∞ –∏–∑ 300‚Äì1000 –º–æ–¥—É–ª–µ–π —Å –≤–µ–∫—Ç–æ—Ä–∞–º–∏ –∑–∞–π–º–µ—Ç –Ω–µ –±–æ–ª–µ–µ 5‚Äì10 –ú–ë. –≠—Ç–æ–≥–æ —Ö–≤–∞—Ç–∏—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã –ø—Ä–æ–µ–∫—Ç–∞ –±–µ–∑ –∑–∞—Ç—Ä–∞—Ç –Ω–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É –ë–î.

**Google Embedding Model:** –ú–æ–¥–µ–ª—å text-embedding-004 —á–µ—Ä–µ–∑ Google AI Studio –±–µ—Å–ø–ª–∞—Ç–Ω–∞ (–ª–∏–º–∏—Ç –¥–æ 15 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É), —á—Ç–æ –∏–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å–∏–º—É–ª—è—Ç–æ—Ä–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.

## üõ† –®–ê–ì 1: –ù–ê–°–¢–†–û–ô–ö–ê SUPABASE (–í–ï–ö–¢–û–†–ù–ê–Ø –ë–î)

### 1.1 –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

1. –ó–∞–π–¥–∏—Ç–µ –Ω–∞ [supabase.com](https://supabase.com) –∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, `Connectum-Platinum`).
2. –í –ª–µ–≤–æ–º –±–æ–∫–æ–≤–æ–º –º–µ–Ω—é –Ω–∞–π–¥–∏—Ç–µ –∏–∫–æ–Ω–∫—É **SQL Editor**.
3. –ù–∞–∂–º–∏—Ç–µ **New Query** –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–π –∫–æ–¥ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã –∏ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ–∏—Å–∫–∞:

### 1.2 SQL-–∫–æ–¥ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã

```sql
-- 1. –í–∫–ª—é—á–∞–µ–º —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –≤–µ–∫—Ç–æ—Ä–∞–º–∏
create extension if not exists vector;

-- 2. –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—É –¥–ª—è –∑–Ω–∞–Ω–∏–π –≤—Å–µ—Ö 6 —à–∫–æ–ª
create table knowledge_base (
  id bigserial primary key,
  modality_id text not null,       -- mpt, cbt, gestalt –∏ —Ç.–¥.
  category text,                   -- –¢–µ–º–∞ (–î–µ–Ω—å–≥–∏, –¢–µ–ª–æ –∏ —Ç.–¥.)
  content text not null,           -- –¢–µ–∫—Å—Ç –∏–Ω—Ç–µ—Ä–≤–µ–Ω—Ü–∏–∏/—Å–æ–≤–µ—Ç–∞
  context_trigger text,           -- –°–∏—Ç—É–∞—Ü–∏—è-—Ç—Ä–∏–≥–≥–µ—Ä
  embedding vector(768)            -- –í–µ–∫—Ç–æ—Ä (—Ä–∞–∑–º–µ—Ä 768 –¥–ª—è –º–æ–¥–µ–ª–∏ Google text-embedding-004)
);

-- 3. –°–æ–∑–¥–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è ¬´—Å–º—ã—Å–ª–æ–≤–æ–≥–æ –ø–æ–∏—Å–∫–∞¬ª (RPC)
create or replace function match_knowledge (
  query_embedding vector(768),
  match_threshold float,
  match_count int,
  filter_modality text
)
returns table (
  id bigint,
  content text,
  context_trigger text,
  similarity float
)
language plpgsql
as $$
begin
  return query
  select
    knowledge_base.id,
    knowledge_base.content,
    knowledge_base.context_trigger,
    1 - (knowledge_base.embedding <=> query_embedding) as similarity
  from knowledge_base
  where knowledge_base.modality_id = filter_modality
    and 1 - (knowledge_base.embedding <=> query_embedding) > match_threshold
  order by knowledge_base.embedding <=> query_embedding
  limit match_count;
end;
$$;
```

### 1.3 –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–ª—é—á–µ–π –¥–æ—Å—Ç—É–ø–∞

1. –í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –ø—Ä–æ–µ–∫—Ç–∞ Supabase –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Settings** ‚Üí **API**.
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ:
   - **URL** (–Ω–∞–ø—Ä–∏–º–µ—Ä, `https://ckbahynhwpdvzzymlitq.supabase.co`)
   - **anon public** (–∫–ª—é—á –ø—É–±–ª–∏—á–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞)

## üîë –®–ê–ì 2: –ü–ï–†–ï–ú–ï–ù–ù–´–ï –û–ö–†–£–ñ–ï–ù–ò–Ø (.ENV)

–î–ª—è —Ä–∞–±–æ—Ç—ã RAG –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –∏ –≤ —Å–∫—Ä–∏–ø—Ç–∞—Ö –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∞–º –ø–æ—Ç—Ä–µ–±—É—é—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–µ –∫–ª—é—á–∏ –≤ —Ñ–∞–π–ª–µ `.env`:

```env
# Supabase (RAG)
SUPABASE_URL=https://ckbahynhwpdvzzymlitq.supabase.co
SUPABASE_KEY=sb_publishable_xuyA8oO7oABxKqZ6NNGamA_SGwroQ8O

# Google AI (Embeddings)
GOOGLE_API_KEY=AIzaSyDvDTSSWPJreS9MImUVL2qaRzxAEv5_HFs

# Cerebras (Llama 3.3 70B)
CEREBRAS_API_KEY=your_cerebras_api_key

# Firebase
FIREBASE_SERVICE_ACCOUNT={"type":"service_account","project_id":"..."}
FIREBASE_PROJECT_ID=your-project-id

# Telegram Bot
TELEGRAM_BOT_TOKEN=your_bot_token

# App ID
APP_ID=connectum-platinum
```

## üöú –®–ê–ì 3: –ó–ê–ì–†–£–ó–ö–ê 300+ –ú–û–î–£–õ–ï–ô (–ê–í–¢–û–ú–ê–¢–ò–ó–ê–¶–ò–Ø)

–ß—Ç–æ–±—ã –Ω–∞–ø–æ–ª–Ω–∏—Ç—å –±–∞–∑—É, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ª—É–∂–µ–±–Ω—ã–π —Å–∫—Ä–∏–ø—Ç `scripts/seed_knowledge_base.js`. –û–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≥–æ–Ω—è–µ—Ç —Ç–µ–∫—Å—Ç —á–µ—Ä–µ–∑ Google API –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≤–µ–∫—Ç–æ—Ä–æ–≤ –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Ö –≤ Supabase.

### 3.1 –ó–∞–ø—É—Å–∫ –∑–∞–≥—Ä—É–∑–∫–∏

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–µ—Å–ª–∏ –µ—â–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã)
npm install @supabase/supabase-js @google/generative-ai dotenv

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –∑–∞–≥—Ä—É–∑–∫–∏
npm run seed
```

### 3.2 –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏

–°–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–∞—Å—Å–∏–≤ `KNOWLEDGE_DATA` —Å –æ–±—ä–µ–∫—Ç–∞–º–∏ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞:

```javascript
{
  mod: 'mpt',           // –ú–æ–¥–∞–ª—å–Ω–æ—Å—Ç—å (mpt, cbt, gestalt, eit, psychoanalysis, ta)
  cat: '–ê–≤—Ç–æ—Ä—Å—Ç–≤–æ',     // –ö–∞—Ç–µ–≥–æ—Ä–∏—è
  trigger: '–ö–ª–∏–µ–Ω—Ç –≥–æ–≤–æ—Ä–∏—Ç "–æ–Ω–æ —Å–∞–º–æ"', // –°–∏—Ç—É–∞—Ü–∏—è-—Ç—Ä–∏–≥–≥–µ—Ä
  text: '–ß—Ç–æ –¢–´ –¥–µ–ª–∞–µ—à—å –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å...', // –¢–µ–∫—Å—Ç –∏–Ω—Ç–µ—Ä–≤–µ–Ω—Ü–∏–∏
  marker: '–ü–µ—Ä–µ—Ö–æ–¥ –≤ —Å—É–±—ä–µ–∫—Ç–Ω—É—é –ø–æ–∑–∏—Ü–∏—é' // –ú–∞—Ä–∫–µ—Ä —É—Å–ø–µ—Ö–∞
}
```

## üß† –®–ê–ì 4: –õ–û–ì–ò–ö–ê –ü–û–ò–°–ö–ê –í –°–ï–†–í–ï–†–ï (RAG ENGINE)

–í `server.js` –≤–Ω–µ–¥—Ä–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `getRelevantKnowledge`. –ü—Ä–æ—Ü–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫:

### 4.1 –í–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

–°–æ–æ–±—â–µ–Ω–∏–µ –ø—Å–∏—Ö–æ–ª–æ–≥–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, ¬´–ö–ª–∏–µ–Ω—Ç –Ω–µ –±–µ—Ä–µ—Ç –Ω–∞ —Å–µ–±—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å¬ª) –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –≤–µ–∫—Ç–æ—Ä —á–∏—Å–µ–ª:

```javascript
async function getEmbedding(text) {
  const model = googleGenAI.getGenerativeModel({ model: "text-embedding-004" });
  const result = await model.embedContent(text);
  return result.embedding.values;
}
```

### 4.2 –ü–æ–∏—Å–∫ –≤ Supabase

–°–µ—Ä–≤–µ—Ä –≤—ã–∑—ã–≤–∞–µ—Ç RPC-—Ñ—É–Ω–∫—Ü–∏—é `match_knowledge` –≤ Supabase:

```javascript
async function getRelevantKnowledge(userMessage, modalityId) {
  const vector = await getEmbedding(userMessage);
  if (!vector) return "";
  
  try {
    const { data: docs, error } = await supabase.rpc('match_knowledge', {
      query_embedding: vector,
      match_threshold: 0.65,  // –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—Ö–æ–∂–µ—Å—Ç—å (65%)
      match_count: 3,         // –í–æ–∑–≤—Ä–∞—â–∞–µ–º 3 –ª—É—á—à–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
      filter_modality: modalityId
    });
    
    if (error || !docs) return "";
    
    return docs.map(d => `–°–ò–¢–£–ê–¶–ò–Ø: ${d.context_trigger}\n–ò–ù–¢–ï–†–í–ï–ù–¶–ò–Ø: ${d.content}`)
               .join('\n\n---\n\n');
  } catch (e) { return ""; }
}
```

### 4.3 –ò–Ω—ä–µ–∫—Ü–∏—è –≤ –ø—Ä–æ–º–ø—Ç

–†–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–∏—Å–∫–∞ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –ò–ò:

```javascript
const knowledge = await getRelevantKnowledge(message, modalityId);
const sys = PromptManager.generateClientPrompt(modalityId, 2, clientProfile, knowledge);
```

## üìä –®–ê–ì 5: –ü–ê–†–ê–ú–ï–¢–†–´ –ü–û–ò–°–ö–ê

### 5.1 –ü–æ—Ä–æ–≥ —Å—Ö–æ–∂–µ—Å—Ç–∏ (match_threshold)

- **0.65** ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–æ—Ä–æ–≥ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- **0.75** ‚Äî —Å—Ç—Ä–æ–≥–∏–π –ø–æ–∏—Å–∫ (—Ç–æ–ª—å–∫–æ –æ—á–µ–Ω—å —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ)
- **0.50** ‚Äî —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫ (–±–æ–ª—å—à–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤, –Ω–æ –º–µ–Ω–µ–µ —Ç–æ—á–Ω—ã—Ö)

### 5.2 –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (match_count)

- **3** ‚Äî –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ –¥–ª—è RAG (–¥–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –±–µ–∑ –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–º–ø—Ç–∞)
- **5** ‚Äî –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤
- **1** ‚Äî –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

### 5.3 –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –º–æ–¥–∞–ª—å–Ω–æ—Å—Ç–∏ (filter_modality)

–§—É–Ω–∫—Ü–∏—è `match_knowledge` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ `modality_id`:
- `mpt` ‚Äî –ú–µ—Ç–∞-–ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∞—è —Ç–µ—Ä–∞–ø–∏—è
- `cbt` ‚Äî –ö–æ–≥–Ω–∏—Ç–∏–≤–Ω–æ-–ø–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫–∞—è —Ç–µ—Ä–∞–ø–∏—è
- `gestalt` ‚Äî –ì–µ—à—Ç–∞–ª—å—Ç-—Ç–µ—Ä–∞–ø–∏—è
- `eit` ‚Äî –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ-–æ–±—Ä–∞–∑–Ω–∞—è —Ç–µ—Ä–∞–ø–∏—è
- `psychoanalysis` ‚Äî –ü—Å–∏—Ö–æ–∞–Ω–∞–ª–∏–∑
- `ta` ‚Äî –¢—Ä–∞–Ω–∑–∞–∫—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑

## üéØ –®–ê–ì 6: –ü–†–ò–ú–ï–†–´ –ó–ê–ü–†–û–°–û–í –ò –û–¢–í–ï–¢–û–í

### –ü—Ä–∏–º–µ—Ä 1: –ó–∞–ø—Ä–æ—Å –ø–æ –ú–ü–¢

**–í—Ö–æ–¥:** ¬´–ö–ª–∏–µ–Ω—Ç –≥–æ–≤–æ—Ä–∏—Ç, —á—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞ —Å–ª—É—á–∞–µ—Ç—Å—è —Å –Ω–∏–º —Å–∞–º–∞¬ª

**–í–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:** `[0.12, -0.45, 0.78, ...]` (768 —á–∏—Å–µ–ª)

**–ü–æ–∏—Å–∫ –≤ Supabase:**
```
–°–ò–¢–£–ê–¶–ò–Ø: –ö–ª–∏–µ–Ω—Ç –≥–æ–≤–æ—Ä–∏—Ç "–æ–Ω–æ —Å–∞–º–æ", "–º–µ–Ω—è –º—É—á–∞–µ—Ç"
–ò–ù–¢–ï–†–í–ï–ù–¶–ò–Ø: –ß—Ç–æ –¢–´ –¥–µ–ª–∞–µ—à—å –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å, —á—Ç–æ–±—ã —ç—Ç–æ –ø—Ä–æ–¥–æ–ª–∂–∞–ª–æ—Å—å? 
–ü–æ–∫–∞–∂–∏ —Ç–µ–ª–æ–º —ç—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ.
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç –ò–ò:** ¬´–Ø —á—É–≤—Å—Ç–≤—É—é, —á—Ç–æ —ç—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å–æ –º–Ω–æ–π...¬ª ‚Üí ¬´–ß—Ç–æ –¢–´ –¥–µ–ª–∞–µ—à—å –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å, —á—Ç–æ–±—ã —ç—Ç–æ –ø—Ä–æ–¥–æ–ª–∂–∞–ª–æ—Å—å?¬ª

### –ü—Ä–∏–º–µ—Ä 2: –ó–∞–ø—Ä–æ—Å –ø–æ –ö–ü–¢

**–í—Ö–æ–¥:** ¬´–ö–ª–∏–µ–Ω—Ç –≤–µ—Ä–∏—Ç, —á—Ç–æ –≤—Å–µ –ø—Ä–æ–ø–∞–ª–æ¬ª

**–ü–æ–∏—Å–∫ –≤ Supabase:**
```
–°–ò–¢–£–ê–¶–ò–Ø: –ö–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∏–∑–∞—Ü–∏—è (–í—Å–µ –ø—Ä–æ–ø–∞–ª–æ)
–ò–ù–¢–ï–†–í–ï–ù–¶–ò–Ø: –ö–∞–∫–æ–≤–∞ —Ä–µ–∞–ª—å–Ω–∞—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —Ö—É–¥—à–µ–≥–æ –∏—Å—Ö–æ–¥–∞ –≤ —Ü–∏—Ñ—Ä–∞—Ö? 
–ö–∞–∫–∏–µ –µ—Å—Ç—å —Ñ–∞–∫—Ç—ã –ø—Ä–æ—Ç–∏–≤ —ç—Ç–æ–π –º—ã—Å–ª–∏?
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç –ò–ò:** ¬´–í—Å–µ –ø—Ä–æ–ø–∞–ª–æ, —è –±–æ–ª—å—à–µ –Ω–µ –º–æ–≥—É...¬ª ‚Üí ¬´–ö–∞–∫–æ–≤–∞ —Ä–µ–∞–ª—å–Ω–∞—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —Ö—É–¥—à–µ–≥–æ –∏—Å—Ö–æ–¥–∞ –≤ —Ü–∏—Ñ—Ä–∞—Ö?¬ª

## üîß –®–ê–ì 7: –û–¢–õ–ê–î–ö–ê –ò –ú–û–ù–ò–¢–û–†–ò–ù–ì

### 7.1 –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ–∫—Ç–æ—Ä–æ–≤

–í SQL Editor Supabase –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–æ–¥—É–ª–µ–π
SELECT modality_id, COUNT(*) 
FROM knowledge_base 
GROUP BY modality_id;

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∏–º–µ—Ä –≤–µ–∫—Ç–æ—Ä–∞
SELECT id, modality_id, context_trigger, embedding[1:5] 
FROM knowledge_base 
LIMIT 1;
```

### 7.2 –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ RAG

–í `server.js` –¥–æ–±–∞–≤—å—Ç–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:

```javascript
async function getRelevantKnowledge(userMessage, modalityId) {
  const vector = await getEmbedding(userMessage);
  if (!vector) {
    console.log('‚ùå RAG: –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –≤–µ–∫—Ç–æ—Ä');
    return "";
  }
  
  const { data: docs, error } = await supabase.rpc('match_knowledge', {
    query_embedding: vector,
    match_threshold: 0.65,
    match_count: 3,
    filter_modality: modalityId
  });
  
  if (error) {
    console.log('‚ùå RAG: –û—à–∏–±–∫–∞ Supabase', error);
    return "";
  }
  
  console.log(`‚úÖ RAG: –ù–∞–π–¥–µ–Ω–æ ${docs.length} –º–æ–¥—É–ª–µ–π –¥–ª—è ${modalityId}`);
  return docs.map(d => `–°–ò–¢–£–ê–¶–ò–Ø: ${d.context_trigger}\n–ò–ù–¢–ï–†–í–ï–ù–¶–ò–Ø: ${d.content}`)
             .join('\n\n---\n\n');
}
```

### 7.3 –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–∏–º–∏—Ç–æ–≤ Google API

Google AI –∏–º–µ–µ—Ç –ª–∏–º–∏—Ç—ã:
- **15 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É** (free tier)
- **1000 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –¥–µ–Ω—å** (free tier)

–ï—Å–ª–∏ –ø—Ä–µ–≤—ã—à–∞–µ—Ç–µ –ª–∏–º–∏—Ç, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–æ—Ç–∞—Ü–∏—é –∫–ª—é—á–µ–π:

```javascript
const googleApiKeys = process.env.GOOGLE_API_KEYS.split(',');
let currentKeyIndex = 0;

function rotateKey() {
  currentKeyIndex = (currentKeyIndex + 1) % googleApiKeys.length;
  console.log(`üîÑ Rotated to key #${currentKeyIndex + 1}`);
}
```

## üìà –®–ê–ì 8: –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø

### 8.1 –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–µ–∫—Ç–æ—Ä–æ–≤

–î–ª—è —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –º–æ–∂–Ω–æ –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å –≤–µ–∫—Ç–æ—Ä—ã –≤ Redis –∏–ª–∏ –≤ –ø–∞–º—è—Ç–∏:

```javascript
const vectorCache = new Map();

async function getEmbeddingWithCache(text) {
  if (vectorCache.has(text)) {
    return vectorCache.get(text);
  }
  
  const vector = await getEmbedding(text);
  vectorCache.set(text, vector);
  return vector;
}
```

### 8.2 –ü–∞–∫–µ—Ç–Ω–∞—è –≤–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

–ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ 300+ –º–æ–¥—É–ª–µ–π –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–∞–∫–µ—Ç–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É:

```javascript
// –ó–∞–≥—Ä—É–∂–∞–π—Ç–µ –ø–æ 10 –º–æ–¥—É–ª–µ–π –∑–∞ —Ä–∞–∑
for (let i = 0; i < KNOWLEDGE_DATA.length; i += 10) {
  const batch = KNOWLEDGE_DATA.slice(i, i + 10);
  await processBatch(batch);
  await new Promise(r => setTimeout(r, 5000)); // –ü–∞—É–∑–∞ 5 —Å–µ–∫
}
```

### 8.3 –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ—Ä–æ–≥–∞

–≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ —Å –ø–æ—Ä–æ–≥–æ–º —Å—Ö–æ–∂–µ—Å—Ç–∏:
- **0.65** ‚Äî –±–∞–ª–∞–Ω—Å —Ç–æ—á–Ω–æ—Å—Ç–∏ –∏ –ø–æ–ª–Ω–æ—Ç—ã
- **0.70** ‚Äî –≤—ã—Å–æ–∫–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å, –º–µ–Ω—å—à–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- **0.60** ‚Äî –±–æ–ª—å—à–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤, –≤–æ–∑–º–æ–∂–Ω—ã –ª–æ–∂–Ω—ã–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è

## üõ° –®–ê–ì 9: –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨

### 9.1 –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –≤ Supabase

–ù–∞—Å—Ç—Ä–æ–π—Ç–µ Row Level Security (RLS) –≤ Supabase:

```sql
-- –†–∞–∑—Ä–µ—à–∏—Ç—å —á—Ç–µ–Ω–∏–µ –≤—Å–µ–º
ALTER TABLE knowledge_base ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Public read access" ON knowledge_base
  FOR SELECT USING (true);
```

### 9.2 –ó–∞—â–∏—Ç–∞ API –∫–ª—é—á–µ–π

- –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ `.env` —Ñ–∞–π–ª
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `.env.example` –¥–ª—è —à–∞–±–ª–æ–Ω–∞
- –•—Ä–∞–Ω–∏—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ –∑–∞—â–∏—â–µ–Ω–Ω–æ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (Vault, AWS Secrets Manager)

### 9.3 –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤

–î–æ–±–∞–≤—å—Ç–µ rate limiting –≤ Express:

```javascript
const rateLimit = require('express-rate-limit');

const limiter = rateLimit({
  windowMs: 15 * 60 * 1000, // 15 –º–∏–Ω—É—Ç
  max: 100 // 100 –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –æ–¥–Ω–æ–≥–æ IP
});

app.use('/api/', limiter);
```

## üéì –®–ê–ì 10: –û–ë–£–ß–ï–ù–ò–ï –ò –ê–ü–ì–†–ï–ô–î

### 10.1 –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –º–æ–¥—É–ª–µ–π

1. –î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–π –æ–±—ä–µ–∫—Ç –≤ `KNOWLEDGE_DATA` –≤ `scripts/seed_knowledge_base.js`
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ `npm run seed`
3. –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—á–Ω–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–æ–≤—ã–µ –º–æ–¥—É–ª–∏

### 10.2 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –º–æ–¥—É–ª–µ–π

```sql
-- –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç –º–æ–¥—É–ª—è
UPDATE knowledge_base 
SET content = '–ù–æ–≤—ã–π —Ç–µ–∫—Å—Ç –∏–Ω—Ç–µ—Ä–≤–µ–Ω—Ü–∏–∏'
WHERE id = 123;

-- –ü–µ—Ä–µ–≤–µ–∫—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å (–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –∑–∞–Ω–æ–≤–æ)
```

### 10.3 –£–¥–∞–ª–µ–Ω–∏–µ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –º–æ–¥—É–ª–µ–π

```sql
DELETE FROM knowledge_base 
WHERE modality_id = 'old_method';
```

## üìã –®–ê–ì 11: –ß–ï–ö-–õ–ò–°–¢ –î–ï–ü–õ–û–Ø

- [ ] Supabase –ø—Ä–æ–µ–∫—Ç —Å–æ–∑–¥–∞–Ω
- [ ] –¢–∞–±–ª–∏—Ü–∞ `knowledge_base` —Å–æ–∑–¥–∞–Ω–∞
- [ ] –§—É–Ω–∫—Ü–∏—è `match_knowledge` —Å–æ–∑–¥–∞–Ω–∞
- [ ] –ü–æ–ª—É—á–µ–Ω—ã URL –∏ –∫–ª—é—á–∏ Supabase
- [ ] –ü–æ–ª—É—á–µ–Ω Google API –∫–ª—é—á
- [ ] –§–∞–π–ª `.env` –∑–∞–ø–æ–ª–Ω–µ–Ω
- [ ] –ó–∞–ø—É—â–µ–Ω `npm run seed`
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–æ–¥—É–ª–µ–π –≤ –±–∞–∑–µ
- [ ] –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å —á–µ—Ä–µ–∑ `/api/chat` —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] RAG –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –º–æ–¥—É–ª–∏
- [ ] –ò–ò –∏—Å–ø–æ–ª—å–∑—É–µ—Ç RAG-–∫–æ–Ω—Ç–µ–∫—Å—Ç –≤ –æ—Ç–≤–µ—Ç–∞—Ö

## üöÄ –®–ê–ì 12: –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨

### –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|---------|----------|-------------|
| –í–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—è | 2-3 —Å–µ–∫/–º–æ–¥—É–ª—å | Google API |
| –ü–æ–∏—Å–∫ –≤ Supabase | 50-100 –º—Å | pgvector |
| –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞ | 1-2 —Å–µ–∫ | Llama 3.3 |
| –û–±—â–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ | 3-5 —Å–µ–∫ | –ü—Ä–∏–µ–º–ª–µ–º–æ |

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:

1. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî —Å–æ—Ö—Ä–∞–Ω—è–π—Ç–µ –≤–µ–∫—Ç–æ—Ä—ã —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
2. **–ü–∞–∫–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** ‚Äî –∑–∞–≥—Ä—É–∂–∞–π—Ç–µ –º–æ–¥—É–ª–∏ –ø–∞—á–∫–∞–º–∏
3. **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å** ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Promise.all –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
4. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** ‚Äî –ª–æ–≥–∏—Ä—É–π—Ç–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è RAG

## üìö –®–ê–ì 13: –†–ï–°–£–†–°–´ –ò –°–°–´–õ–ö–ò

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
- [Supabase Vector](https://supabase.com/docs/guides/ai)
- [Google Generative AI](https://ai.google.dev/docs)
- [pgvector](https://github.com/pgvector/pgvector)

### –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:
- [Supabase Dashboard](https://supabase.com/dashboard)
- [Google AI Studio](https://makersuite.google.com/)
- [Cerebras API](https://www.cerebras.ai/)

### –°–æ–æ–±—â–µ—Å—Ç–≤–æ:
- [Supabase Discord](https://discord.gg/supabase)
- [Google AI Discord](https://discord.gg/google-ai)

## üéØ –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

**Connectum Pro RAG** ‚Äî —ç—Ç–æ –º–æ—â–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª—è–µ—Ç –ò–ò ¬´–ø–æ–º–Ω–∏—Ç—å¬ª 300+ –º–µ—Ç–æ–¥–∏–∫ —Ç–µ—Ä–∞–ø–∏–∏ –∏ –ø—Ä–∏–º–µ–Ω—è—Ç—å –∏—Ö –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏. –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:

1. **–°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫** ‚Äî –ø–æ–Ω–∏–º–∞–Ω–∏–µ —Å–º—ã—Å–ª–∞, –∞ –Ω–µ –ø—Ä–æ—Å—Ç–æ —Å–ª–æ–≤
2. **–ë—ã—Å—Ç—Ä–æ–¥–µ–π—Å—Ç–≤–∏–µ** ‚Äî –ø–æ–∏—Å–∫ –∑–∞ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—ã
3. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** ‚Äî –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –º–æ–¥—É–ª–∏
4. **–ë–µ—Å–ø–ª–∞—Ç–Ω–æ—Å—Ç—å** ‚Äî Supabase Free Tier –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è —Å—Ç–∞—Ä—Ç–∞
5. **–¢–æ—á–Ω–æ—Å—Ç—å** ‚Äî –º–µ—Ç–æ–¥–∏—á–µ—Å–∫–∏–µ –∑–Ω–∞–Ω–∏—è –ò–ò-—Ç–µ—Ä–∞–ø–µ–≤—Ç–∞

**Connectum Pro v20.2 Platinum** ‚Äî —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ —á–∞—Ç-–±–æ—Ç, –∞ –Ω–∞—Å—Ç–æ—è—â–∏–π –ò–ò-—Ç–µ—Ä–∞–ø–µ–≤—Ç —Å –≥–ª—É–±–æ–∫–∏–º–∏ –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–º–∏ –∑–Ω–∞–Ω–∏—è–º–∏!
